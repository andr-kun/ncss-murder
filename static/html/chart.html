<article>
	<h2>Murder Chart</h2>

	<svg id="murder-chart"></svg>

	<style>
		svg#murder-chart {
			width: 100%;
			height: 400px;
		}
	</style>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.js"></script>

	<script>
		d3.json('/murder?game={{ game_id }}', function(murders) {
			var murdersByLocation = d3.nest()
				.key(function(murder) { return murder.location; })
				.key(function(murder) { return moment(murder.datetime).format('Do of MMM'); })
				.rollup(function(murders) { return murders.length; })
				.entries(murders);

			nv.addGraph(function() {
				var chart = nv.models.multiBarChart()
					.x(function(murderSet) { return murderSet.key; })
					.y(function(murderSet) { return murderSet.values; })
					.transitionDuration(350)
					.reduceXTicks(true)
					.rotateLabels(0)
					.showControls(true)
					.groupSpacing(0.1);

				chart.yAxis
					.tickFormat(d3.format('d'));

				d3.select('#murder-chart')
					.datum(murdersByLocation)
					.call(chart);

				nv.utils.windowResize(chart.update);

				return chart;
			});
		});
	</script>
</article>
